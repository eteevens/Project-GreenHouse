<!DOCTYPE html> <!-- names the type of document, in this case, HTML5 -->
<html>

<head>

<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script><!--The chart.js library-->

<style>

p {
  font-family: verdana;
}

h1 {
  font-family: verdana;
}

img {
  margin: 0;
}

iframe {
  border: 0;
}

.graphics {
  grid-area: graph;
}

.video {
  grid-area: camera;
}

.time-controls {
  grid-area: timing;
}

.other-controls {
  grid-area: controls;
  padding-top: 0%;
}

.layout-container {
  display: grid;
  grid-template-areas:
  'graph graph graph graph camera camera camera'
  'graph graph graph graph camera camera camera'
  'graph graph graph graph camera camera camera'
  'graph graph graph graph timing timing timing'
  'graph graph graph graph timing timing timing'
  'controls controls controls controls timing timing timing';
  grid-template-columns: 12% 12% 12% 12% 12% 12% 12%;
  grid-template-rows: 12% 12% 12% 12% 12% 12%;
  grid-gap: 2%;
  justify-content: center;
}

.layout-container > div {
  text-align: center;
  outline: 1px outset black;
  font-family: verdana;
}

</style>

</head>

<body>

  <!-- tempoary header and grid layout of the project-->
  <h1 style="text-align:center;"> Project GreenHouse </h1>

  <div class=layout-container>
    <div class=graphics><div>
      <canvas id="live_graph"></canvas>
    </div></div>
    <div class=video><img src="{{ url_for('video_feed_route') }}" height=100%></img>
    </div>
    <div class=time-controls><iframe src="/calendar_feed"></iframe></div>
    <div class=other-controls width=100%>
        <button>Lights</button>
        <button>Water Drips</button>
        <button>Save Data</button><br>
        <input type="range"></input><p>temperature</p>
    </div>
  </div>

  <!--suppress JSUnresolvedLibraryURL -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
  <!--suppress JSUnresolvedLibraryURL -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <!--suppress JSUnresolvedLibraryURL -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
  <script>
    $(document).ready(function () {

    const data = {
      datasets: [{
        label: 'Random Dataset',
        backgroundColor: 'rgb(0, 210, 0)',
        borderColor: 'rgb(0, 210, 0)',
        data: [],
        fill: false
      }]
    };

    const config = {
      type: 'line',
      labels: [],
      data: data,
      options: {
        responsive: true,
        scales: {
          y: {beginAtZero: true},
        },
        animation: false
      }
    };

      const context = document.getElementById('live_graph').getContext('2d');

      const live_graph = new Chart(context, config);

      const source = new EventSource("/graph_feed");

      source.onmessage = function (event) {
        const data = JSON.parse(event.data);
        if (config.data.labels.length === 10) {
          config.data.labels.shift();
          config.data.datasets[0].data.shift();
        }
        config.data.labels.push(data.time);
        config.data.datasets[0].data.push(data.value);
        live_graph.update();
      };
    });

  </script>

</body>

</html>
